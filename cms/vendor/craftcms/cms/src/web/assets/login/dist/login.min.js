!function(s){var t=Garnish.Base.extend({$form:null,$loginNameInput:null,$passwordInput:null,$rememberMeCheckbox:null,$forgotPasswordLink:null,$rememberPasswordLink:null,$submitBtn:null,$spinner:null,$errors:null,forgotPassword:!1,validateOnInput:!1,init:function(){this.$form=s("#login-form"),this.$loginNameInput=s("#loginName"),this.$passwordInput=s("#password"),this.$rememberMeCheckbox=s("#rememberMe"),this.$forgotPasswordLink=s("#forgot-password"),this.$rememberPasswordLink=s("#remember-password"),this.$submitBtn=s("#submit"),this.$spinner=s("#spinner"),this.$errors=s("#login-errors"),new Craft.PasswordInput(this.$passwordInput,{onToggleInput:s.proxy((function(s){this.removeListener(this.$passwordInput,"input"),this.$passwordInput=s,this.addListener(this.$passwordInput,"input","onInput")}),this)}),this.addListener(this.$loginNameInput,"input","onInput"),this.addListener(this.$passwordInput,"input","onInput"),this.addListener(this.$forgotPasswordLink,"click","onSwitchForm"),this.addListener(this.$rememberPasswordLink,"click","onSwitchForm"),this.addListener(this.$form,"submit","onSubmit")},validate:function(){const s=this.$loginNameInput.val();if(0===s.length)return window.useEmailAsUsername?Craft.t("app","Invalid email."):Craft.t("app","Invalid username or email.");if(window.useEmailAsUsername&&!s.match(".+@.+..+"))return Craft.t("app","Invalid email.");if(!this.forgotPassword){const s=this.$passwordInput.val().length;if(s<window.minPasswordLength)return Craft.t("yii","{attribute} should contain at least {min, number} {min, plural, one{character} other{characters}}.",{attribute:Craft.t("app","Password"),min:window.minPasswordLength});if(s>window.maxPasswordLength)return Craft.t("yii","{attribute} should contain at most {max, number} {max, plural, one{character} other{characters}}.",{attribute:Craft.t("app","Password"),max:window.maxPasswordLength})}return!0},onInput:function(s){this.validateOnInput&&!0===this.validate()&&this.clearErrors()},onSubmit:function(s){s.preventDefault();const t=this.validate();if(!0!==t)return this.showError(t),void(this.validateOnInput=!0);this.$submitBtn.addClass("active"),this.$spinner.removeClass("hidden"),this.clearErrors(),this.forgotPassword?this.submitForgotPassword():this.submitLogin()},submitForgotPassword:function(){var t={loginName:this.$loginNameInput.val()};Craft.postActionRequest("users/send-password-reset-email",t,s.proxy((function(s,t){"success"===t&&(s.success?new r:this.showError(s.error)),this.onSubmitResponse()}),this))},submitLogin:function(){var t={loginName:this.$loginNameInput.val(),password:this.$passwordInput.val(),rememberMe:this.$rememberMeCheckbox.prop("checked")?"y":""};return Craft.postActionRequest("users/login",t,s.proxy((function(s,t){"success"===t?s.success?window.location.href=s.returnUrl:(Garnish.shake(this.$form),this.onSubmitResponse(),this.showError(s.error)):this.onSubmitResponse()}),this)),!1},onSubmitResponse:function(){this.$submitBtn.removeClass("active"),this.$spinner.addClass("hidden")},showError:function(t){this.clearErrors(),s('<p style="display: none;">'+t+"</p>").appendTo(this.$errors).velocity("fadeIn")},clearErrors:function(){this.$errors.empty()},onSwitchForm:function(s){Garnish.isMobileBrowser()||this.$loginNameInput.trigger("focus"),this.clearErrors(),this.forgotPassword=!this.forgotPassword,this.$form.toggleClass("reset-password",this.forgotPassword),this.$submitBtn.text(Craft.t("app",this.forgotPassword?"Reset Password":"Login"))}}),r=Garnish.Modal.extend({init:function(){var t=s('<div class="modal fitted email-sent"><div class="body">'+Craft.t("app","Check your email for instructions to reset your password.")+"</div></div>").appendTo(Garnish.$bod);this.base(t)},hide:function(){}});new t}(jQuery);
//# sourceMappingURL=login.min.js.map
